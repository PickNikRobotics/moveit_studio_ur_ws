<?xml version='1.0' encoding='UTF-8'?>
<root BTCPP_format="4" main_tree_to_execute="Human Recovery">
  <!--The integer value used here for teleoperation mode comes from the moveit_studio_sdk_msgs/TeleoperationMode ROS message.-->
  <BehaviorTree ID="Human Recovery" _description="" _favorite="false" _hardcoded="false">
    <Control ID="Sequence">
      <Action ID="Script" code="teleop_mode := 0"/>
      <Control ID="Parallel" success_count="1" failure_count="1">
        <Action ID="DoTeleoperateAction" enable_user_interaction="{enable_user_interaction}" user_interaction_prompt="{user_interaction_prompt}" initial_teleop_mode="{initial_teleop_mode}" current_teleop_mode="{teleop_mode}"/>
        <Control ID="Sequence" _skipIf="teleop_complete == 'yes'">
          <!--Closing and opening the gripper-->
          <Decorator ID="ForceSuccess" _skipIf="teleop_mode != 7">
            <SubTree ID="Close Gripper"/>
          </Decorator>
          <Decorator ID="ForceSuccess" _skipIf="teleop_mode != 6">
            <SubTree ID="Open Gripper"/>
          </Decorator>
          <!--Joint sliders interpolate to joint state-->
          <Decorator ID="ForceSuccess" _while="teleop_mode == 5">
            <Control ID="Sequence">
              <Action ID="SwitchUIPrimaryView" primary_view_name="Visualization"/>
              <SubTree ID="Teleoperate Interpolate to Joint State" _collapsed="true" teleop_complete="{teleop_complete}"/>
            </Control>
          </Decorator>
          <!--Interactive markers move to pose-->
          <Decorator ID="ForceSuccess" _while="teleop_mode == 4">
            <Control ID="Sequence">
              <Action ID="SwitchUIPrimaryView" primary_view_name="Visualization"/>
              <SubTree ID="Teleoperate Move to Pose" controller_names="/joint_trajectory_controller" _collapsed="true" teleop_complete="{teleop_complete}"/>
            </Control>
          </Decorator>
          <!--Waypoint buttons move to joint state-->
          <Decorator ID="ForceSuccess" _while="teleop_mode == 3">
            <Control ID="Sequence">
              <Action ID="SwitchUIPrimaryView" primary_view_name="Visualization"/>
              <SubTree ID="Teleoperate Move to Joint State" _collapsed="true" teleop_complete="{teleop_complete}"/>
            </Control>
          </Decorator>
          <!--Cartesian and joint jogging-->
          <Control ID="Sequence" _while="teleop_mode == 2">
            <Action ID="SwitchUIPrimaryView" primary_view_name="Visualization"/>
            <Action ID="TeleoperateTwist" controller_name="servo_controller"/>
          </Control>
          <Control ID="Sequence" _while="teleop_mode == 1">
            <Action ID="SwitchUIPrimaryView" primary_view_name="Visualization"/>
            <Action ID="TeleoperateJointJog" controller_name="servo_controller"/>
          </Control>
        </Control>
      </Control>
    </Control>
  </BehaviorTree>
  <TreeNodesModel>
    <SubTree ID="Human Recovery">
      <input_port name="enable_user_interaction" default="false"/>
      <input_port name="user_interaction_prompt" default=" "/>
      <input_port name="initial_teleop_mode" default="4"/>
      <input_port name="teleop_complete" default="{teleop_complete}"/>
    </SubTree>
  </TreeNodesModel>
</root>
